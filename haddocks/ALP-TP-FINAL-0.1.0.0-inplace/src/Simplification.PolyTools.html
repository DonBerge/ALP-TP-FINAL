<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-name-shadowing #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html"><span class="hs-identifier">Simplification.PolyTools</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">exponent</span></span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PExpr.html"><span class="hs-identifier">PExpr</span></a></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Number.html"><span class="hs-identifier">Number</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">N</span></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Symplify.html"><span class="hs-identifier">Symplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Symplify.html#simplifyPow"><span class="hs-identifier">simplifyPow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#freeOf"><span class="hs-identifier">freeOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier">simplifyDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#simplifySum"><span class="hs-identifier">simplifySum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier">simplifyProduct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#simplifySub"><span class="hs-identifier">simplifySub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#denominator"><span class="hs-identifier">denominator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#numerator"><span class="hs-identifier">numerator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Symplify.html#simplifyNegate"><span class="hs-identifier">simplifyNegate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html"><span class="hs-identifier">Simplification.Algebraic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Algebraic</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="annot"><a href="Simplification.PolyTools.html#isSymbol"><span class="hs-identifier hs-type">isSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-18"></span><span id="isSymbol"><span class="annot"><span class="annottext">isSymbol :: PExpr -&gt; Bool
</span><a href="Simplification.PolyTools.html#isSymbol"><span class="hs-identifier hs-var hs-var">isSymbol</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Fun"><span class="hs-identifier hs-type">Fun</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-19"></span><span class="annot"><a href="Simplification.PolyTools.html#isSymbol"><span class="hs-identifier hs-var">isSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">-- The list [c, m] where m is the degree of the monomial and c is the coefficient of xm</span><span>
</span><span id="line-22"></span><span id="local-6989586621679061857"><span class="annot"><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-type">coefficientMonomialGPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061857"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-23"></span><span id="coefficientMonomialGPE"><span class="annot"><span class="annottext">coefficientMonomialGPE :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var hs-var">coefficientMonomialGPE</span></a></span></span><span> </span><span id="local-6989586621679062051"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062051"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062052"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062052"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062051"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062052"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; m (PExpr, Integer)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="annot"><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Pow"><span class="hs-identifier hs-type">Pow</span></a></span><span> </span><span id="local-6989586621679062054"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062054"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679062056"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062056"><span class="hs-identifier hs-var">exponent</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062057"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062057"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TriBool -&gt; Bool
</span><a href="TriBool.html#true"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="annot"><span class="annottext">(TriBool -&gt; Bool) -&gt; TriBool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062054"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062057"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TriBool -&gt; TriBool
forall a b c. BAlgebra a b c =&gt; a -&gt; b -&gt; c
</span><a href="TriBool.html#%26%26%26"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Number -&gt; TriBool
forall a. Assumptions a =&gt; a -&gt; TriBool
</span><a href="Classes.Assumptions.html#isInteger"><span class="hs-identifier hs-var">isInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062056"><span class="hs-identifier hs-var">exponent</span></a></span><span> </span><span class="annot"><span class="annottext">TriBool -&gt; Bool -&gt; TriBool
forall a b c. BAlgebra a b c =&gt; a -&gt; b -&gt; c
</span><a href="TriBool.html#%26%26%26"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062056"><span class="hs-identifier hs-var">exponent</span></a></span><span> </span><span class="annot"><span class="annottext">Number -&gt; Number -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Number
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; m (PExpr, Integer)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Number -&gt; Integer
</span><a href="Number.html#numerator"><span class="hs-identifier hs-var">N.numerator</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062056"><span class="hs-identifier hs-var">exponent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="annot"><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span id="local-6989586621679062063"><span class="annot"><span class="annottext">u :: PExpr
</span><a href="#local-6989586621679062063"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span id="local-6989586621679062065"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062065"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062066"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062066"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; m (PExpr, Integer)) -&gt; [PExpr] -&gt; m [(PExpr, Integer)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-operator hs-var">`coefficientMonomialGPE`</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062066"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062065"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">m [(PExpr, Integer)]
-&gt; ([(PExpr, Integer)] -&gt; m (PExpr, Integer)) -&gt; m (PExpr, Integer)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, Integer) -&gt; (PExpr, Integer) -&gt; m (PExpr, Integer))
-&gt; (PExpr, Integer) -&gt; [(PExpr, Integer)] -&gt; m (PExpr, Integer)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; (PExpr, Integer) -&gt; m (PExpr, Integer)
forall {m :: * -&gt; *} {a}.
MonadFail m =&gt;
(PExpr, Integer) -&gt; (a, Integer) -&gt; m (PExpr, Integer)
</span><a href="#local-6989586621679062068"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062063"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>        </span><span id="local-6989586621679062068"><span class="annot"><span class="annottext">combine :: (PExpr, Integer) -&gt; (a, Integer) -&gt; m (PExpr, Integer)
</span><a href="#local-6989586621679062068"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062091"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062091"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679062092"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062092"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; m (PExpr, Integer)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062091"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062092"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="#local-6989586621679062068"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062093"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062093"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyPow"><span class="hs-identifier hs-var">simplifyPow</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062066"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PExpr
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062093"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; (PExpr -&gt; m PExpr) -&gt; m PExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-var">simplifyDiv</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062063"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; (PExpr -&gt; m (PExpr, Integer)) -&gt; m (PExpr, Integer)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062094"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062094"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; m (PExpr, Integer)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062094"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062093"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="annot"><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span id="local-6989586621679062095"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062095"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062096"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062096"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
</span><a href="Symplify.html#freeOf"><span class="hs-identifier hs-var">freeOf</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062095"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062096"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; m (PExpr, Integer)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062095"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (PExpr, Integer)
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not a general monomial expression&quot;</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span id="local-6989586621679061889"><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061889"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061889"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span></span><span>
</span><span id="line-36"></span><span id="degreeGPE"><span class="annot"><span class="annottext">degreeGPE :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var hs-var">degreeGPE</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679062113"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062113"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062114"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062114"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PExpr -&gt; m Integer) -&gt; Integer -&gt; [PExpr] -&gt; m Integer
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679062115"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062115"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679062116"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062116"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062115"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; ((PExpr, Integer) -&gt; Integer) -&gt; (PExpr, Integer) -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; Integer
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, Integer) -&gt; Integer) -&gt; m (PExpr, Integer) -&gt; m Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062116"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062114"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062113"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-comment">--maximum $ map (`degreeGPE` x) us</span><span>
</span><span id="line-37"></span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span id="local-6989586621679062121"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062121"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062122"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062122"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, Integer) -&gt; Integer
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, Integer) -&gt; Integer) -&gt; m (PExpr, Integer) -&gt; m Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062121"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062122"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span id="local-6989586621679061899"><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-type">coefficientGPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061899"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061899"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-40"></span><span id="coefficientGPE"><span class="annot"><span class="annottext">coefficientGPE :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; Integer -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-var hs-var">coefficientGPE</span></a></span></span><span> </span><span id="local-6989586621679062143"><span class="annot"><span class="annottext">u :: PExpr
</span><a href="#local-6989586621679062143"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679062144"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062144"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062145"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062145"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679062146"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062146"><span class="hs-identifier hs-var">j</span></a></span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062143"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062145"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062146"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; PExpr -&gt; m PExpr) -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062147"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062144"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-43"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>            </span><span id="local-6989586621679062147"><span class="annot"><span class="annottext">combine :: PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062147"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679062162"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062162"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679062163"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062163"><span class="hs-identifier hs-var">mon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>                                </span><span class="hs-special">(</span><span id="local-6989586621679062164"><span class="annot"><a href="#local-6989586621679062164"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679062165"><span class="annot"><a href="#local-6989586621679062165"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062163"><span class="hs-identifier hs-var">mon</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062145"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-46"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062165"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621679062146"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-47"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-type">simplifySum</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062162"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062164"><span class="hs-identifier hs-type">c'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-48"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062162"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-49"></span><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-var">coefficientGPE</span></a></span><span> </span><span id="local-6989586621679062166"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062166"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062167"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062167"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679062168"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062168"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679062169"><span class="annot"><a href="#local-6989586621679062169"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679062170"><span class="annot"><a href="#local-6989586621679062170"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, Integer)
</span><a href="Simplification.PolyTools.html#coefficientMonomialGPE"><span class="hs-identifier hs-var">coefficientMonomialGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062166"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062167"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-51"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062168"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621679062170"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-52"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062169"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-53"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span id="local-6989586621679061903"><span class="annot"><a href="Simplification.PolyTools.html#coefficientListGPE"><span class="hs-identifier hs-type">coefficientListGPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-56"></span><span id="coefficientListGPE"><span class="annot"><span class="annottext">coefficientListGPE :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m [PExpr]
</span><a href="Simplification.PolyTools.html#coefficientListGPE"><span class="hs-identifier hs-var hs-var">coefficientListGPE</span></a></span></span><span> </span><span id="local-6989586621679062182"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062182"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062183"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062183"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>                            </span><span id="local-6989586621679062184"><span class="annot"><a href="#local-6989586621679062184"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m Integer
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062182"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062183"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-58"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-type">coefficientGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062182"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062183"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><a href="#local-6989586621679062184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span id="local-6989586621679062185"><span class="annot"><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-type">leadingCoefficient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062185"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062185"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-61"></span><span id="leadingCoefficient"><span class="annot"><span class="annottext">leadingCoefficient :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-var hs-var">leadingCoefficient</span></a></span></span><span> </span><span id="local-6989586621679062192"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062192"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062193"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062193"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>                            </span><span id="local-6989586621679062194"><span class="annot"><a href="#local-6989586621679062194"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m Integer
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062192"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062193"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-63"></span><span>                            </span><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-type">coefficientGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062192"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062193"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062194"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621679061907"><span class="annot"><a href="Simplification.PolyTools.html#leadingMonomial"><span class="hs-identifier hs-type">leadingMonomial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061907"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-66"></span><span id="leadingMonomial"><span class="annot"><span class="annottext">leadingMonomial :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingMonomial"><span class="hs-identifier hs-var hs-var">leadingMonomial</span></a></span></span><span> </span><span id="local-6989586621679062204"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062204"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062205"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062205"><span class="hs-identifier hs-var">symbols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>                                </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PExpr -&gt; Bool) -&gt; [PExpr] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; Bool
</span><a href="Simplification.PolyTools.html#isSymbol"><span class="hs-identifier hs-var">isSymbol</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062205"><span class="hs-identifier hs-var">symbols</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;leadingMonomial: not all arguments are symbols&quot;</span></span><span>
</span><span id="line-68"></span><span>                                </span><span class="annot"><span class="annottext">[PExpr] -&gt; PExpr -&gt; m PExpr
forall {m :: * -&gt; *}. MonadFail m =&gt; [PExpr] -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062207"><span class="hs-identifier hs-var">leadingMonomial'</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062205"><span class="hs-identifier hs-var">symbols</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062204"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>        </span><span id="local-6989586621679062207"><span class="annot"><span class="annottext">leadingMonomial' :: [PExpr] -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062207"><span class="hs-identifier hs-var hs-var">leadingMonomial'</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679062227"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062227"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062227"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="#local-6989586621679062207"><span class="hs-identifier hs-var">leadingMonomial'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062228"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062228"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679062229"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062229"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062230"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062230"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>                                    </span><span id="local-6989586621679062231"><span class="annot"><a href="#local-6989586621679062231"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m Integer
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062230"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062228"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-73"></span><span>                                    </span><span id="local-6989586621679062232"><span class="annot"><a href="#local-6989586621679062232"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-type">coefficientGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062230"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062228"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062231"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-74"></span><span>                                    </span><span id="local-6989586621679062233"><span class="annot"><a href="#local-6989586621679062233"><span class="hs-identifier hs-var">xm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyPow"><span class="hs-identifier hs-type">simplifyPow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062228"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromInteger</span></span><span> </span><span class="annot"><a href="#local-6989586621679062231"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>                                    </span><span id="local-6989586621679062234"><span class="annot"><a href="#local-6989586621679062234"><span class="hs-identifier hs-var">lm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062207"><span class="hs-identifier hs-type">leadingMonomial'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062229"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062232"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-76"></span><span>                                    </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062233"><span class="hs-identifier hs-type">xm</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062234"><span class="hs-identifier hs-type">lm</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- division with integer coefficients</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- u and v are rational multivariate polynomials</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- l is a list of symbols</span><span>
</span><span id="line-81"></span><span id="local-6989586621679061913"><span class="annot"><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-type">recPolyDivide</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-82"></span><span id="recPolyDivide"><span class="annot"><span class="annottext">recPolyDivide :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-var hs-var">recPolyDivide</span></a></span></span><span> </span><span id="local-6989586621679062253"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062253"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062254"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062254"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>                        </span><span id="local-6989586621679062255"><span class="annot"><a href="#local-6989586621679062255"><span class="hs-identifier hs-var">udivv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-var">simplifyDiv</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062253"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062254"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-84"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="TriBool.html#true"><span class="hs-identifier hs-type">true</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Classes.Assumptions.html#isInteger"><span class="hs-identifier hs-type">isInteger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062255"><span class="hs-identifier hs-type">udivv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062255"><span class="hs-identifier hs-type">udivv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062253"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="annot"><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-var">recPolyDivide</span></a></span><span> </span><span id="local-6989586621679062256"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062256"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062257"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062257"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062258"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062258"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679062259"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062259"><span class="hs-identifier hs-var">tl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span>
</span><span id="line-88"></span><span>                                </span><span id="local-6989586621679062260"><span class="annot"><a href="#local-6989586621679062260"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m Integer
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062256"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062258"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-89"></span><span>                                </span><span id="local-6989586621679062261"><span class="annot"><a href="#local-6989586621679062261"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062257"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062258"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-90"></span><span>                                </span><span id="local-6989586621679062262"><span class="annot"><a href="#local-6989586621679062262"><span class="hs-identifier hs-var">lcv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-type">leadingCoefficient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062257"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062258"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-91"></span><span>                                </span><span class="annot"><a href="#local-6989586621679062263"><span class="hs-identifier hs-type">recPolyDivideLoop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062262"><span class="hs-identifier hs-type">lcv</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621679062256"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062260"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062261"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>        </span><span id="local-6989586621679062263"><span class="annot"><span class="annottext">recPolyDivideLoop :: PExpr -&gt; PExpr -&gt; PExpr -&gt; Integer -&gt; Integer -&gt; m (PExpr, PExpr)
</span><a href="#local-6989586621679062263"><span class="hs-identifier hs-var hs-var">recPolyDivideLoop</span></a></span></span><span> </span><span id="local-6989586621679062303"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062303"><span class="hs-identifier hs-var">lcv</span></a></span></span><span> </span><span id="local-6989586621679062304"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062304"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679062305"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062305"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679062306"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062306"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679062307"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062307"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-94"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062306"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062307"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>                        </span><span id="local-6989586621679062308"><span class="annot"><a href="#local-6989586621679062308"><span class="hs-identifier hs-var">lcr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-var">leadingCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062305"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062258"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-96"></span><span>                        </span><span id="local-6989586621679062309"><span class="annot"><a href="#local-6989586621679062309"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-type">recPolyDivide</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062308"><span class="hs-identifier hs-type">lcr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062303"><span class="hs-identifier hs-type">lcv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062259"><span class="hs-identifier hs-type">tl</span></a></span><span>
</span><span id="line-97"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><a href="#local-6989586621679062309"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-98"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062304"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062312"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062312"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; m (PExpr, PExpr)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062312"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062305"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062313"><span class="annot"><a href="#local-6989586621679062313"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr)
</span><a href="#local-6989586621679062309"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-101"></span><span>                                </span><span id="local-6989586621679062315"><span class="annot"><a href="#local-6989586621679062315"><span class="hs-identifier hs-var">xmn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyPow"><span class="hs-identifier hs-type">simplifyPow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062258"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromInteger</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679062306"><span class="hs-identifier hs-type">m</span></a></span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span class="annot"><a href="#local-6989586621679062307"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>                                </span><span id="local-6989586621679062316"><span class="annot"><a href="#local-6989586621679062316"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062313"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062315"><span class="hs-identifier hs-type">xmn</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062317"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062317"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-var">simplifySum</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062304"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062317"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- q' = q + c*x^(m-n)</span><span>
</span><span id="line-103"></span><span>                                </span><span id="local-6989586621679062318"><span class="annot"><a href="#local-6989586621679062318"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062313"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062257"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679062315"><span class="hs-identifier hs-type">xmn</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifySub"><span class="hs-identifier hs-type">simplifySub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062305"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-comment">-- r' = r - c*v*x^(m-n)</span><span>
</span><span id="line-104"></span><span>                                </span><span id="local-6989586621679062319"><span class="annot"><a href="#local-6989586621679062319"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062305"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062258"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-105"></span><span>                                </span><span class="annot"><a href="#local-6989586621679062263"><span class="hs-identifier hs-type">recPolyDivideLoop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062303"><span class="hs-identifier hs-type">lcv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062316"><span class="hs-identifier hs-type">q'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062318"><span class="hs-identifier hs-type">r'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062319"><span class="hs-identifier hs-type">m'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062307"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; m PExpr -&gt; m PExpr
</span><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-var">Algebraic.expand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062304"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; (PExpr -&gt; m (PExpr, PExpr)) -&gt; m (PExpr, PExpr)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062320"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062320"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; m (PExpr, PExpr)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062320"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062305"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span id="local-6989586621679061919"><span class="annot"><a href="Simplification.PolyTools.html#recQuotient"><span class="hs-identifier hs-type">recQuotient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061919"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061919"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-110"></span><span id="recQuotient"><span class="annot"><span class="annottext">recQuotient :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#recQuotient"><span class="hs-identifier hs-var hs-var">recQuotient</span></a></span></span><span> </span><span id="local-6989586621679062328"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062328"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062329"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062329"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062330"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062330"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, PExpr) -&gt; PExpr) -&gt; m (PExpr, PExpr) -&gt; m PExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-var">recPolyDivide</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062328"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062329"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062330"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="local-6989586621679062331"><span class="annot"><a href="Simplification.PolyTools.html#recRemainder"><span class="hs-identifier hs-type">recRemainder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062331"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-113"></span><span id="recRemainder"><span class="annot"><span class="annottext">recRemainder :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#recRemainder"><span class="hs-identifier hs-var hs-var">recRemainder</span></a></span></span><span> </span><span id="local-6989586621679062339"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062339"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062340"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062340"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062341"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062341"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, PExpr) -&gt; PExpr) -&gt; m (PExpr, PExpr) -&gt; m PExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#recPolyDivide"><span class="hs-identifier hs-var">recPolyDivide</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062339"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062340"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062341"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- Division de polinomios basada en monomios</span><span>
</span><span id="line-116"></span><span id="local-6989586621679062342"><span class="annot"><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-type">polyDivide</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062342"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062342"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-117"></span><span id="polyDivide"><span class="annot"><span class="annottext">polyDivide :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-var hs-var">polyDivide</span></a></span></span><span> </span><span id="local-6989586621679062351"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062351"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062352"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062352"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062353"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062353"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062355"><span class="annot"><span class="annottext">q :: PExpr
</span><a href="#local-6989586621679062355"><span class="hs-identifier hs-var hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-119"></span><span>                        </span><span id="local-6989586621679062356"><span class="annot"><span class="annottext">r :: PExpr
</span><a href="#local-6989586621679062356"><span class="hs-identifier hs-var hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062351"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-120"></span><span>                    </span><span id="local-6989586621679062357"><span class="annot"><a href="#local-6989586621679062357"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingMonomial"><span class="hs-identifier hs-var">leadingMonomial</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062352"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062353"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-121"></span><span>                    </span><span id="local-6989586621679062358"><span class="annot"><a href="#local-6989586621679062358"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062359"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062356"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062357"><span class="hs-identifier hs-type">vl</span></a></span><span>
</span><span id="line-122"></span><span>                    </span><span class="annot"><a href="#local-6989586621679062360"><span class="hs-identifier hs-type">polyDivide'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062355"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062356"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062358"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062357"><span class="hs-identifier hs-type">vl</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621679062360"><span class="annot"><span class="annottext">polyDivide' :: PExpr -&gt; PExpr -&gt; PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
</span><a href="#local-6989586621679062360"><span class="hs-identifier hs-var hs-var">polyDivide'</span></a></span></span><span> </span><span id="local-6989586621679062382"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062382"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679062383"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062383"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679062384"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062384"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679062385"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062385"><span class="hs-identifier hs-var">vl</span></a></span></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062384"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>                        </span><span id="local-6989586621679062386"><span class="annot"><a href="#local-6989586621679062386"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-var">simplifySum</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062382"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062384"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>                        </span><span id="local-6989586621679062387"><span class="annot"><a href="#local-6989586621679062387"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifySub"><span class="hs-identifier hs-type">simplifySub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062383"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062384"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062352"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>                        </span><span id="local-6989586621679062389"><span class="annot"><a href="#local-6989586621679062389"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062359"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062387"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062385"><span class="hs-identifier hs-type">vl</span></a></span><span>
</span><span id="line-129"></span><span>                        </span><span class="annot"><a href="#local-6989586621679062360"><span class="hs-identifier hs-type">polyDivide'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062386"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062387"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062389"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062385"><span class="hs-identifier hs-type">vl</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; m (PExpr, PExpr)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062382"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062383"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>        </span><span id="local-6989586621679062359"><span class="annot"><span class="annottext">g :: PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062359"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679062412"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062412"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062413"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062413"><span class="hs-identifier hs-var">vm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; m PExpr) -&gt; [PExpr] -&gt; m [PExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062359"><span class="hs-operator hs-var">`g`</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062413"><span class="hs-identifier hs-var">vm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062412"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">m [PExpr] -&gt; ([PExpr] -&gt; m PExpr) -&gt; m PExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-var">simplifySum</span></a></span><span>  </span><span class="hs-comment">-- g = sum ui / vm, donde ui es divisible por vm</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><a href="#local-6989586621679062359"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span id="local-6989586621679062414"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062414"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679062415"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062415"><span class="hs-identifier hs-var">wm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>                    </span><span id="local-6989586621679062416"><span class="annot"><a href="#local-6989586621679062416"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-var">simplifyDiv</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062414"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062415"><span class="hs-identifier hs-var">wm</span></a></span><span>
</span><span id="line-135"></span><span>                    </span><span id="local-6989586621679062417"><span class="annot"><a href="#local-6989586621679062417"><span class="hs-identifier hs-var">dw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#denominator"><span class="hs-identifier hs-type">denominator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062416"><span class="hs-identifier hs-type">w'</span></a></span><span>
</span><span id="line-136"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062417"><span class="hs-identifier hs-type">dw</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-137"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062416"><span class="hs-identifier hs-type">w'</span></a></span><span>
</span><span id="line-138"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-139"></span><span>    </span><span>
</span><span id="line-140"></span><span class="annot"><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-type">variables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span id="variables"><span class="annot"><span class="annottext">variables :: PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var hs-var">variables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span class="annot"><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span id="local-6989586621679062419"><span class="annot"><span class="annottext">u :: PExpr
</span><a href="#local-6989586621679062419"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Pow"><span class="hs-identifier hs-type">Pow</span></a></span><span> </span><span id="local-6989586621679062420"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062420"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062421"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062421"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TriBool -&gt; Bool
</span><a href="TriBool.html#true"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr -&gt; TriBool
forall a. Assumptions a =&gt; a -&gt; TriBool
</span><a href="Classes.Assumptions.html#isInteger"><span class="hs-identifier hs-var">isInteger</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062421"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">TriBool -&gt; Bool -&gt; TriBool
forall a b c. BAlgebra a b c =&gt; a -&gt; b -&gt; c
</span><a href="TriBool.html#%26%26%26"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062421"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062420"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062419"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span class="annot"><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679062422"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062422"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PExpr] -&gt; [PExpr] -&gt; [PExpr]) -&gt; [PExpr] -&gt; [[PExpr]] -&gt; [PExpr]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; [PExpr] -&gt; [PExpr]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">union</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([[PExpr]] -&gt; [PExpr]) -&gt; [[PExpr]] -&gt; [PExpr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; [PExpr]) -&gt; [PExpr] -&gt; [[PExpr]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062422"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span id="local-6989586621679062425"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062425"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([PExpr] -&gt; [PExpr] -&gt; [PExpr]) -&gt; [PExpr] -&gt; [[PExpr]] -&gt; [PExpr]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; [PExpr] -&gt; [PExpr]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">union</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([[PExpr]] -&gt; [PExpr]) -&gt; [[PExpr]] -&gt; [PExpr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; [PExpr]) -&gt; [PExpr] -&gt; [[PExpr]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062425"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span id="local-6989586621679062426"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062426"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062426"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span id="local-6989586621679061936"><span class="annot"><a href="Simplification.PolyTools.html#divmod"><span class="hs-identifier hs-type">divmod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061936"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-150"></span><span id="divmod"><span class="annot"><span class="annottext">divmod :: forall (m :: * -&gt; *).
MonadFail m =&gt;
m PExpr -&gt; m PExpr -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#divmod"><span class="hs-identifier hs-var hs-var">divmod</span></a></span></span><span> </span><span id="local-6989586621679062435"><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062435"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062436"><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062436"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>                </span><span id="local-6989586621679062437"><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; m PExpr -&gt; m PExpr
</span><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-var">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062435"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-152"></span><span>                </span><span id="local-6989586621679062438"><span class="annot"><a href="#local-6989586621679062438"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062436"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-153"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062439"><span class="annot"><a href="#local-6989586621679062439"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062438"><span class="hs-identifier hs-var">q'</span></a></span><span>
</span><span id="line-154"></span><span>                </span><span class="annot"><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-type">polyDivide</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062437"><span class="hs-identifier hs-type">p'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062438"><span class="hs-identifier hs-type">q'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062439"><span class="hs-identifier hs-type">vars</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="local-6989586621679062440"><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-157"></span><span id="quotient"><span class="annot"><span class="annottext">quotient :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-var hs-var">quotient</span></a></span></span><span> </span><span id="local-6989586621679062448"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062448"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062449"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062449"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679062450"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062450"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, PExpr) -&gt; PExpr) -&gt; m (PExpr, PExpr) -&gt; m PExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-var">polyDivide</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062448"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062449"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062450"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621679062451"><span class="annot"><a href="Simplification.PolyTools.html#remainder"><span class="hs-identifier hs-type">remainder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062451"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062451"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-160"></span><span id="remainder"><span class="annot"><span class="annottext">remainder :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#remainder"><span class="hs-identifier hs-var hs-var">remainder</span></a></span></span><span> </span><span id="local-6989586621679062459"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062459"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062460"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062460"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679062461"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062461"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, PExpr) -&gt; PExpr) -&gt; m (PExpr, PExpr) -&gt; m PExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-var">polyDivide</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062459"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062460"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062461"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">---</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span id="local-6989586621679061940"><span class="annot"><a href="Simplification.PolyTools.html#pseudoDivision"><span class="hs-identifier hs-type">pseudoDivision</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061940"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061940"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-166"></span><span id="pseudoDivision"><span class="annot"><span class="annottext">pseudoDivision :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#pseudoDivision"><span class="hs-identifier hs-var hs-var">pseudoDivision</span></a></span></span><span> </span><span id="local-6989586621679062472"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062472"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062473"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062473"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062474"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062474"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062476"><span class="annot"><span class="annottext">p :: PExpr
</span><a href="#local-6989586621679062476"><span class="hs-identifier hs-var hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-168"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062477"><span class="annot"><span class="annottext">s :: PExpr
</span><a href="#local-6989586621679062477"><span class="hs-identifier hs-var hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062472"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-169"></span><span>                        </span><span id="local-6989586621679062478"><span class="annot"><a href="#local-6989586621679062478"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m Integer
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m Integer
</span><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-var">degreeGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062477"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062474"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-170"></span><span>                        </span><span id="local-6989586621679062479"><span class="annot"><a href="#local-6989586621679062479"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062473"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062474"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-171"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062485"><span class="annot"><a href="#local-6989586621679062485"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062478"><span class="hs-identifier hs-var">m</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062479"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-172"></span><span>                        </span><span id="local-6989586621679062487"><span class="annot"><a href="#local-6989586621679062487"><span class="hs-identifier hs-var">lcv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-type">coefficientGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062473"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062474"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062479"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-173"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062489"><span class="annot"><a href="#local-6989586621679062489"><span class="hs-identifier hs-var hs-var">sigma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-174"></span><span>                        </span><span class="annot"><a href="#local-6989586621679062490"><span class="hs-identifier hs-type">pseudoDivision'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062476"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062477"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062478"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062479"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062485"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062487"><span class="hs-identifier hs-type">lcv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062489"><span class="hs-identifier hs-type">sigma</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679062490"><span class="annot"><span class="annottext">pseudoDivision' :: PExpr
-&gt; PExpr
-&gt; Integer
-&gt; Integer
-&gt; Integer
-&gt; PExpr
-&gt; Integer
-&gt; m (PExpr, PExpr)
</span><a href="#local-6989586621679062490"><span class="hs-identifier hs-var hs-var">pseudoDivision'</span></a></span></span><span> </span><span id="local-6989586621679062540"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062540"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062541"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062541"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679062542"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062542"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679062543"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062543"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062544"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062544"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621679062545"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062545"><span class="hs-identifier hs-var">lcv</span></a></span></span><span> </span><span id="local-6989586621679062546"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062546"><span class="hs-identifier hs-var">sigma</span></a></span></span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062542"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062543"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#polyDivide"><span class="hs-identifier hs-var">polyDivide</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062472"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062473"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062474"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- both u and v do not have x as main variable</span><span>
</span><span id="line-178"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062542"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062543"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>                        </span><span id="local-6989586621679062548"><span class="annot"><a href="#local-6989586621679062548"><span class="hs-identifier hs-var">lcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; Integer -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; Integer -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#coefficientGPE"><span class="hs-identifier hs-var">coefficientGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062541"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062474"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062542"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-comment">-- 0</span><span>
</span><span id="line-180"></span><span>                        </span><span id="local-6989586621679062549"><span class="annot"><a href="#local-6989586621679062549"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyPow"><span class="hs-identifier hs-type">simplifyPow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062474"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromInteger</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679062542"><span class="hs-identifier hs-type">m</span></a></span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span class="annot"><a href="#local-6989586621679062543"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 1</span><span>
</span><span id="line-181"></span><span>                        </span><span id="local-6989586621679062550"><span class="annot"><a href="#local-6989586621679062550"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>                                </span><span id="local-6989586621679062551"><span class="annot"><a href="#local-6989586621679062551"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062545"><span class="hs-identifier hs-type">lcv</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062540"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>                                </span><span id="local-6989586621679062552"><span class="annot"><a href="#local-6989586621679062552"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062548"><span class="hs-identifier hs-type">lcs</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062549"><span class="hs-identifier hs-type">x'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>                                </span><span class="annot"><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-type">simplifySum</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062551"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062552"><span class="hs-identifier hs-type">b'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>                        </span><span id="local-6989586621679062553"><span class="annot"><a href="#local-6989586621679062553"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>                                </span><span id="local-6989586621679062554"><span class="annot"><a href="#local-6989586621679062554"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062545"><span class="hs-identifier hs-type">lcv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679062541"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span>                                </span><span id="local-6989586621679062555"><span class="annot"><a href="#local-6989586621679062555"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062548"><span class="hs-identifier hs-type">lcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679062473"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679062549"><span class="hs-identifier hs-type">x'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span>                                </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifySub"><span class="hs-identifier hs-type">simplifySub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062554"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062555"><span class="hs-identifier hs-type">b'</span></a></span><span>
</span><span id="line-189"></span><span>                        </span><span class="hs-comment">-- let sigma = sigma + 1</span><span>
</span><span id="line-190"></span><span>                        </span><span id="local-6989586621679062556"><span class="annot"><a href="#local-6989586621679062556"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062553"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062474"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-191"></span><span>                        </span><span class="annot"><a href="#local-6989586621679062490"><span class="hs-identifier hs-type">pseudoDivision'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062550"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062553"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062543"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062544"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062545"><span class="hs-identifier hs-type">lcv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062546"><span class="hs-identifier hs-type">sigma</span></a></span><span class="annot"><span class="hs-operator hs-type">+</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>                            </span><span id="local-6989586621679062557"><span class="annot"><a href="#local-6989586621679062557"><span class="hs-identifier hs-var">lcv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyPow"><span class="hs-identifier hs-var">simplifyPow</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062545"><span class="hs-identifier hs-var">lcv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PExpr
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; PExpr) -&gt; Integer -&gt; PExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062544"><span class="hs-identifier hs-var">delta</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062546"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>                            </span><span id="local-6989586621679062558"><span class="annot"><a href="#local-6989586621679062558"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062557"><span class="hs-identifier hs-type">lcv'</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062540"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>                            </span><span id="local-6989586621679062559"><span class="annot"><a href="#local-6989586621679062559"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062557"><span class="hs-identifier hs-type">lcv'</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062541"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062558"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062559"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621679061943"><span class="annot"><a href="Simplification.PolyTools.html#pseudoRem"><span class="hs-identifier hs-type">pseudoRem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061943"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061943"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-199"></span><span id="pseudoRem"><span class="annot"><span class="annottext">pseudoRem :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#pseudoRem"><span class="hs-identifier hs-var hs-var">pseudoRem</span></a></span></span><span> </span><span id="local-6989586621679062567"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062567"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062568"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062568"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062569"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062569"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; PExpr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PExpr, PExpr) -&gt; PExpr) -&gt; m (PExpr, PExpr) -&gt; m PExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
</span><a href="Simplification.PolyTools.html#pseudoDivision"><span class="hs-identifier hs-var">pseudoDivision</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062567"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062568"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062569"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- Find the unit normal form of u, the coefficient domain is the rational numbers</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- A unit is an expresion that has a multiplicative inverse.</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- An expression u is unit normal if</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- 1. u = 0 or u = 1</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- 2. u = v*w, where v and w are unit normals</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- 3. There exists a unique unit c such that c*u is unit normal</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- In Z, the unit normal expresions are the positive integers, in Q,</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- the only unique normal elements are 0 and 1</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- A polynomial u in K[x] is unit normal if lc(u) is unit normal</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- A polynomial u in K[x,y,...] is unit normal if lc(u) is unit normal in K[y,...]</span><span>
</span><span id="line-213"></span><span id="local-6989586621679062570"><span class="annot"><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-type">normalize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-214"></span><span id="normalize"><span class="annot"><span class="annottext">normalize :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-var hs-var">normalize</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span id="local-6989586621679062583"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062583"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062584"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062584"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; PExpr -&gt; m PExpr) -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-var">leadingCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062583"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062584"><span class="hs-identifier hs-var">l</span></a></span><span>  </span><span class="annot"><span class="annottext">m PExpr -&gt; (PExpr -&gt; m PExpr) -&gt; m PExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-var">simplifyDiv</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062583"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- Check if a polynomial is unit normal</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621679061946"><span id="local-6989586621679061947"><span class="annot"><a href="Simplification.PolyTools.html#normalized"><span class="hs-identifier hs-type">normalized</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679061946"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061947"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061946"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061947"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-220"></span><span id="normalized"><span class="annot"><span class="annottext">normalized :: forall (t :: * -&gt; *) (m :: * -&gt; *).
(Foldable t, MonadFail m) =&gt;
PExpr -&gt; t PExpr -&gt; m Bool
</span><a href="Simplification.PolyTools.html#normalized"><span class="hs-identifier hs-var hs-var">normalized</span></a></span></span><span> </span><span id="local-6989586621679062598"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062598"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062599"><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062599"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>                    </span><span id="local-6989586621679062600"><span class="annot"><a href="#local-6989586621679062600"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; PExpr -&gt; m PExpr) -&gt; PExpr -&gt; t PExpr -&gt; m PExpr
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-var">leadingCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062598"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062599"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-222"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679062600"><span class="hs-identifier hs-type">lc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621679062600"><span class="hs-identifier hs-type">lc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span id="local-6989586621679062602"><span class="annot"><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-type">polyPrimitivePart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-225"></span><span id="polyPrimitivePart"><span class="annot"><span class="annottext">polyPrimitivePart :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-var hs-var">polyPrimitivePart</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-226"></span><span class="annot"><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-var">polyPrimitivePart</span></a></span><span> </span><span id="local-6989586621679062615"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062615"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062616"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062616"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679062617"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062617"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>                            </span><span id="local-6989586621679062618"><span class="annot"><a href="#local-6989586621679062618"><span class="hs-identifier hs-var">contU</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyContent"><span class="hs-identifier hs-var">polyContent</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062615"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062616"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062617"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-228"></span><span>                            </span><span id="local-6989586621679062620"><span class="annot"><a href="#local-6989586621679062620"><span class="hs-identifier hs-var">rem</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#remainder"><span class="hs-identifier hs-type">remainder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062615"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062618"><span class="hs-identifier hs-type">contU</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062616"><span class="hs-identifier hs-type">x</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621679062617"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>                            </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062615"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062618"><span class="hs-identifier hs-type">contU</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062616"><span class="hs-identifier hs-type">x</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621679062617"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span id="local-6989586621679062621"><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-type">polyGCD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-232"></span><span id="polyGCD"><span class="annot"><span class="annottext">polyGCD :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-var hs-var">polyGCD</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621679062634"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062634"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062635"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062635"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062634"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062635"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-233"></span><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-var">polyGCD</span></a></span><span> </span><span id="local-6989586621679062636"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062636"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621679062637"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062637"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062636"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062637"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-var">polyGCD</span></a></span><span> </span><span id="local-6989586621679062638"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062638"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062639"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062639"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062640"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062640"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="#local-6989586621679062641"><span class="hs-identifier hs-var">polyGCDRec</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062638"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062639"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062640"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; (PExpr -&gt; m PExpr) -&gt; m PExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#normalize"><span class="hs-operator hs-var">`normalize`</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062640"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621679062641"><span class="annot"><span class="annottext">polyGCDRec :: PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="#local-6989586621679062641"><span class="hs-identifier hs-var hs-var">polyGCDRec</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- gcd(u,v) where u and v are non-zero rationals is 1</span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><a href="#local-6989586621679062641"><span class="hs-identifier hs-var">polyGCDRec</span></a></span><span> </span><span id="local-6989586621679062666"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062666"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062667"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062667"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062668"><span class="annot"><span class="annottext">l :: [PExpr]
</span><a href="#local-6989586621679062668"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679062669"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062669"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679062670"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062670"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>                                    </span><span id="local-6989586621679062671"><span class="annot"><a href="#local-6989586621679062671"><span class="hs-identifier hs-var">contU</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyContent"><span class="hs-identifier hs-var">polyContent</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062666"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062669"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062670"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-239"></span><span>                                    </span><span id="local-6989586621679062672"><span class="annot"><a href="#local-6989586621679062672"><span class="hs-identifier hs-var">contV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#polyContent"><span class="hs-identifier hs-type">polyContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062667"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062669"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062670"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-240"></span><span>                                    </span><span>
</span><span id="line-241"></span><span>                                    </span><span id="local-6989586621679062673"><span class="annot"><a href="#local-6989586621679062673"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062641"><span class="hs-identifier hs-type">polyGCDRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062671"><span class="hs-identifier hs-type">contU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062672"><span class="hs-identifier hs-type">contV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062670"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-242"></span><span>                                    </span><span>
</span><span id="line-243"></span><span>                                    </span><span id="local-6989586621679062674"><span class="annot"><a href="#local-6989586621679062674"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062666"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062671"><span class="hs-identifier hs-type">contU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062668"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-comment">-- primitive part of u</span><span>
</span><span id="line-244"></span><span>                                    </span><span id="local-6989586621679062675"><span class="annot"><a href="#local-6989586621679062675"><span class="hs-identifier hs-var">ppV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062667"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062672"><span class="hs-identifier hs-type">contV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062668"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-comment">-- primitive part of v</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>                                    </span><span id="local-6989586621679062676"><span class="annot"><a href="#local-6989586621679062676"><span class="hs-identifier hs-var">rp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062677"><span class="hs-identifier hs-type">gcdRec'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062669"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062670"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062674"><span class="hs-identifier hs-type">ppU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062675"><span class="hs-identifier hs-type">ppV</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>                                    </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679062673"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062676"><span class="hs-identifier hs-type">rp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>        </span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621679062677"><span class="annot"><span class="annottext">gcdRec' :: PExpr -&gt; [PExpr] -&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062677"><span class="hs-identifier hs-var hs-var">gcdRec'</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679062701"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062701"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062701"><span class="hs-identifier hs-var">ppU</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><a href="#local-6989586621679062677"><span class="hs-identifier hs-var">gcdRec'</span></a></span><span> </span><span id="local-6989586621679062702"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062702"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679062703"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062703"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621679062704"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062704"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span id="local-6989586621679062705"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062705"><span class="hs-identifier hs-var">ppV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>                                    </span><span id="local-6989586621679062706"><span class="annot"><a href="#local-6989586621679062706"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#pseudoRem"><span class="hs-identifier hs-var">pseudoRem</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062704"><span class="hs-identifier hs-var">ppU</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062705"><span class="hs-identifier hs-var">ppV</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062702"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-253"></span><span>                                    </span><span id="local-6989586621679062707"><span class="annot"><a href="#local-6989586621679062707"><span class="hs-identifier hs-var">ppR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-type">polyPrimitivePart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062706"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062702"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062703"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-254"></span><span>                                    </span><span id="local-6989586621679062708"><span class="annot"><a href="#local-6989586621679062708"><span class="hs-identifier hs-var">degU</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#degreeGPE"><span class="hs-identifier hs-type">degreeGPE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062704"><span class="hs-identifier hs-type">ppU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062702"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-255"></span><span>                                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062707"><span class="hs-identifier hs-type">ppR</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621679062704"><span class="hs-identifier hs-type">ppU</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621679062708"><span class="hs-identifier hs-type">degU</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- Avoids infinite recursion</span><span>
</span><span id="line-256"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-257"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="#local-6989586621679062677"><span class="hs-identifier hs-type">gcdRec'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062702"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062703"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062705"><span class="hs-identifier hs-type">ppV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062707"><span class="hs-identifier hs-type">ppR</span></a></span><span> </span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span id="local-6989586621679061954"><span class="annot"><a href="Simplification.PolyTools.html#remainderSequence"><span class="hs-identifier hs-type">remainderSequence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-260"></span><span id="remainderSequence"><span class="annot"><span class="annottext">remainderSequence :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m [PExpr]
</span><a href="Simplification.PolyTools.html#remainderSequence"><span class="hs-identifier hs-var hs-var">remainderSequence</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m [PExpr]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Remainder sequence undefined for empty lists&quot;</span></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Simplification.PolyTools.html#remainderSequence"><span class="hs-identifier hs-var">remainderSequence</span></a></span><span> </span><span id="local-6989586621679062720"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062720"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062721"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062721"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062722"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062722"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679062723"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062723"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>                                    </span><span id="local-6989586621679062724"><span class="annot"><a href="#local-6989586621679062724"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-var">polyPrimitivePart</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062720"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062722"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062723"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-263"></span><span>                                    </span><span id="local-6989586621679062725"><span class="annot"><a href="#local-6989586621679062725"><span class="hs-identifier hs-var">ppV</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-type">polyPrimitivePart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062721"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062722"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062723"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-264"></span><span>                                    </span><span class="annot"><a href="#local-6989586621679062726"><span class="hs-identifier hs-type">remainderSequence'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062724"><span class="hs-identifier hs-type">ppU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062725"><span class="hs-identifier hs-type">ppV</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-266"></span><span>        </span><span id="local-6989586621679062726"><span class="annot"><span class="annottext">remainderSequence' :: PExpr -&gt; PExpr -&gt; m [PExpr]
</span><a href="#local-6989586621679062726"><span class="hs-identifier hs-var hs-var">remainderSequence'</span></a></span></span><span> </span><span id="local-6989586621679062746"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062746"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m [PExpr]
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062746"><span class="hs-identifier hs-var">ppU</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><a href="#local-6989586621679062726"><span class="hs-identifier hs-var">remainderSequence'</span></a></span><span> </span><span id="local-6989586621679062747"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062747"><span class="hs-identifier hs-var">ppU</span></a></span></span><span> </span><span id="local-6989586621679062748"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062748"><span class="hs-identifier hs-var">ppV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>                                        </span><span id="local-6989586621679062749"><span class="annot"><a href="#local-6989586621679062749"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#pseudoRem"><span class="hs-identifier hs-var">pseudoRem</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062747"><span class="hs-identifier hs-var">ppU</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062748"><span class="hs-identifier hs-var">ppV</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062722"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-269"></span><span>                                        </span><span id="local-6989586621679062750"><span class="annot"><a href="#local-6989586621679062750"><span class="hs-identifier hs-var">ppR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#polyPrimitivePart"><span class="hs-identifier hs-type">polyPrimitivePart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062749"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062722"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062723"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-270"></span><span>                                        </span><span id="local-6989586621679062751"><span class="annot"><a href="#local-6989586621679062751"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062726"><span class="hs-identifier hs-type">remainderSequence'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062748"><span class="hs-identifier hs-type">ppV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062750"><span class="hs-identifier hs-type">ppR</span></a></span><span>
</span><span id="line-271"></span><span>                                        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679062747"><span class="hs-identifier hs-type">ppU</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621679062751"><span class="hs-identifier hs-type">rs</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span id="local-6989586621679061960"><span class="annot"><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-type">gcdList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061960"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061960"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-274"></span><span id="gcdList"><span class="annot"><span class="annottext">gcdList :: forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-var hs-var">gcdList</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-var">gcdList</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679062761"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062761"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621679062762"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062762"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#normalize"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062761"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062762"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span>
</span><span id="line-276"></span><span class="annot"><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-var">gcdList</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679062763"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062763"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679062764"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062764"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679062765"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062765"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>                    </span><span id="local-6989586621679062766"><span class="annot"><a href="#local-6989586621679062766"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; [PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-var">gcdList</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062764"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062765"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-278"></span><span>                    </span><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-type">polyGCD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062763"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062766"><span class="hs-identifier hs-type">ps'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062765"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span id="local-6989586621679062767"><span class="annot"><a href="Simplification.PolyTools.html#polyContent"><span class="hs-identifier hs-type">polyContent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-281"></span><span id="polyContent"><span class="annot"><span class="annottext">polyContent :: forall (m :: * -&gt; *).
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polyContent"><span class="hs-identifier hs-var hs-var">polyContent</span></a></span></span><span> </span><span id="local-6989586621679062773"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062773"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062774"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062774"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679062775"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062775"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>                      </span><span id="local-6989586621679062776"><span class="annot"><a href="#local-6989586621679062776"><span class="hs-identifier hs-var">cfl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m [PExpr]
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m [PExpr]
</span><a href="Simplification.PolyTools.html#coefficientListGPE"><span class="hs-identifier hs-var">coefficientListGPE</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062773"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062774"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span>
</span><span id="line-283"></span><span>                      </span><span class="annot"><a href="Simplification.PolyTools.html#gcdList"><span class="hs-identifier hs-type">gcdList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062776"><span class="hs-identifier hs-type">cfl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062775"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span id="local-6989586621679061963"><span class="annot"><a href="Simplification.PolyTools.html#polGCD"><span class="hs-identifier hs-type">polGCD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679061963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679061963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679061963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-286"></span><span id="polGCD"><span class="annot"><span class="annottext">polGCD :: forall (m :: * -&gt; *).
MonadFail m =&gt;
m PExpr -&gt; m PExpr -&gt; [m PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#polGCD"><span class="hs-identifier hs-var hs-var">polGCD</span></a></span></span><span> </span><span id="local-6989586621679062788"><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062788"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621679062789"><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062789"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679062790"><span class="annot"><span class="annottext">[m PExpr]
</span><a href="#local-6989586621679062790"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>                </span><span id="local-6989586621679062791"><span class="annot"><a href="#local-6989586621679062791"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; m PExpr -&gt; m PExpr
</span><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-var">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="annottext">m PExpr
</span><a href="#local-6989586621679062788"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-288"></span><span>                </span><span id="local-6989586621679062792"><span class="annot"><a href="#local-6989586621679062792"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062789"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-289"></span><span>                </span><span id="local-6989586621679062793"><span class="annot"><a href="#local-6989586621679062793"><span class="hs-identifier hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">sequence</span></span><span> </span><span class="annot"><a href="#local-6989586621679062790"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-type">polyGCD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062791"><span class="hs-identifier hs-type">u'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062792"><span class="hs-identifier hs-type">v'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062793"><span class="hs-identifier hs-type">l'</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="local-6989586621679062795"><span class="annot"><a href="Simplification.PolyTools.html#lcmList"><span class="hs-identifier hs-type">lcmList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062795"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062795"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-293"></span><span id="lcmList"><span class="annot"><span class="annottext">lcmList :: forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#lcmList"><span class="hs-identifier hs-var hs-var">lcmList</span></a></span></span><span> </span><span id="local-6989586621679062810"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062810"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>                </span><span id="local-6989586621679062811"><span class="annot"><a href="#local-6989586621679062811"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; m PExpr -&gt; m PExpr
</span><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-var">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="annottext">(m PExpr -&gt; m PExpr) -&gt; m PExpr -&gt; m PExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-var">simplifyProduct</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062810"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062812"><span class="annot"><a href="#local-6989586621679062812"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062811"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062813"><span class="annot"><a href="#local-6989586621679062813"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; [[PExpr]]
forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621679062814"><span class="hs-identifier hs-var">removeEachElement</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062810"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-297"></span><span>                </span><span id="local-6989586621679062815"><span class="annot"><a href="#local-6989586621679062815"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-type">simplifyProduct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062813"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`gcdList`</span></span><span> </span><span class="annot"><span class="hs-identifier">v</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062811"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062815"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062812"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-300"></span><span>                </span><span id="local-6989586621679061968"><span class="annot"><a href="#local-6989586621679062814"><span class="hs-identifier hs-type">removeEachElement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679061968"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679061968"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-301"></span><span>                </span><span id="local-6989586621679062814"><span class="annot"><span class="annottext">removeEachElement :: forall a. [a] -&gt; [[a]]
</span><a href="#local-6989586621679062814"><span class="hs-identifier hs-var hs-var">removeEachElement</span></a></span></span><span> </span><span id="local-6989586621679062825"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679062825"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; [a]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062827"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679062825"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; [a]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062827"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679062825"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679062827"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062827"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679062825"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span id="local-6989586621679062830"><span class="annot"><a href="Simplification.PolyTools.html#rationalSimplify"><span class="hs-identifier hs-type">rationalSimplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-304"></span><span id="rationalSimplify"><span class="annot"><span class="annottext">rationalSimplify :: forall (m :: * -&gt; *). MonadFail m =&gt; m PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#rationalSimplify"><span class="hs-identifier hs-var hs-var">rationalSimplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; m PExpr) -&gt; m PExpr -&gt; m PExpr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">(=&lt;&lt;)</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>        </span><span id="local-6989586621679062840"><span class="annot"><span class="annottext">numberCoefficientList :: PExpr -&gt; [Number]
</span><a href="#local-6989586621679062840"><span class="hs-identifier hs-var hs-var">numberCoefficientList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679062841"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062841"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062841"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Number
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679062842"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062842"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062842"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679062843"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062843"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; [Number]) -&gt; [PExpr] -&gt; [Number]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [Number]
</span><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679062843"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Number
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621679062864"><span class="annot"><span class="annottext">signNormalized :: PExpr -&gt; t PExpr -&gt; m Bool
</span><a href="#local-6989586621679062864"><span class="hs-identifier hs-var hs-var">signNormalized</span></a></span></span><span> </span><span id="local-6989586621679062865"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062865"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062866"><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062866"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>                                </span><span id="local-6989586621679062867"><span class="annot"><a href="#local-6989586621679062867"><span class="hs-identifier hs-var">lcp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; PExpr -&gt; m PExpr) -&gt; PExpr -&gt; t PExpr -&gt; m PExpr
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Simplification.PolyTools.html#leadingCoefficient"><span class="hs-identifier hs-var">leadingCoefficient</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062865"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062866"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-314"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062867"><span class="hs-identifier hs-type">lcp</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621679062867"><span class="hs-identifier hs-type">lcp</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621679062894"><span class="annot"><span class="annottext">simplfyNumbers :: PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var hs-var">simplfyNumbers</span></a></span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (PExpr, PExpr)
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Division by zero&quot;</span></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">simplfyNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PExpr, PExpr) -&gt; m (PExpr, PExpr)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">simplfyNumbers</span></a></span><span> </span><span id="local-6989586621679062895"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062895"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062896"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062896"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-319"></span><span>                                </span><span id="local-6989586621679062897"><span class="annot"><span class="annottext">c :: [Number]
</span><a href="#local-6989586621679062897"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [Number]
</span><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062895"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Number] -&gt; [Number] -&gt; [Number]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [Number]
</span><a href="#local-6989586621679062840"><span class="hs-identifier hs-var">numberCoefficientList</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062896"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-320"></span><span>                                </span><span class="hs-special">(</span><span id="local-6989586621679062906"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062906"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679062907"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062907"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Number -&gt; (Integer, Integer) -&gt; (Integer, Integer))
-&gt; (Integer, Integer) -&gt; [Number] -&gt; (Integer, Integer)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679062909"><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062909"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; (Integer -&gt; Integer) -&gt; (Integer, Integer) -&gt; (Integer, Integer)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">gcd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Number -&gt; Integer
</span><a href="Number.html#numerator"><span class="hs-identifier hs-var">N.numerator</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062909"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">lcm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Number -&gt; Integer
</span><a href="Number.html#denominator"><span class="hs-identifier hs-var">N.denominator</span></a></span><span> </span><span class="annot"><span class="annottext">Number
</span><a href="#local-6989586621679062909"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Number]
</span><a href="#local-6989586621679062897"><span class="hs-identifier hs-var">c</span></a></span><span>  </span><span class="hs-comment">-- n' is lcm of the denominators and d' is the gcd of the numerators</span><span>
</span><span id="line-321"></span><span>                             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>                                  </span><span id="local-6989586621679062914"><span class="annot"><a href="#local-6989586621679062914"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; PExpr -&gt; m PExpr
</span><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-var">simplifyDiv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PExpr
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062906"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; PExpr
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679062907"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                                  </span><span id="local-6989586621679062915"><span class="annot"><a href="#local-6989586621679062915"><span class="hs-identifier hs-var">n''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062895"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062914"><span class="hs-identifier hs-type">c'</span></a></span><span>
</span><span id="line-324"></span><span>                                  </span><span id="local-6989586621679062916"><span class="annot"><a href="#local-6989586621679062916"><span class="hs-identifier hs-var">d''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062896"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062914"><span class="hs-identifier hs-type">c'</span></a></span><span>
</span><span id="line-325"></span><span>                                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062915"><span class="hs-identifier hs-type">n''</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679062916"><span class="hs-identifier hs-type">d''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621679062945"><span class="annot"><span class="annottext">simplifySign :: PExpr -&gt; PExpr -&gt; t PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062945"><span class="hs-identifier hs-var hs-var">simplifySign</span></a></span></span><span> </span><span id="local-6989586621679062946"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062946"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062947"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062947"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679062948"><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062948"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>                                </span><span id="local-6989586621679062949"><span class="annot"><a href="#local-6989586621679062949"><span class="hs-identifier hs-var">normn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; t PExpr -&gt; m Bool
forall {m :: * -&gt; *} {t :: * -&gt; *}.
(Foldable t, MonadFail m) =&gt;
PExpr -&gt; t PExpr -&gt; m Bool
</span><a href="#local-6989586621679062864"><span class="hs-identifier hs-var">signNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062946"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062948"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-329"></span><span>                                </span><span id="local-6989586621679062950"><span class="annot"><a href="#local-6989586621679062950"><span class="hs-identifier hs-var">normd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679062864"><span class="hs-identifier hs-type">signNormalized</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062947"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062948"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-330"></span><span>                                </span><span id="local-6989586621679062951"><span class="annot"><a href="#local-6989586621679062951"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062949"><span class="hs-identifier hs-type">normn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062946"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Symplify.html#simplifyNegate"><span class="hs-identifier hs-type">simplifyNegate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062946"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-331"></span><span>                                </span><span id="local-6989586621679062952"><span class="annot"><a href="#local-6989586621679062952"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062950"><span class="hs-identifier hs-type">normd</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679062947"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Symplify.html#simplifyNegate"><span class="hs-identifier hs-type">simplifyNegate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062947"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-332"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679062949"><span class="hs-identifier hs-type">normn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621679062950"><span class="hs-identifier hs-type">normd</span></a></span><span> </span><span class="hs-comment">-- if both n and d had the same sign, do nothing otherwise negate the quotient</span><span>
</span><span id="line-333"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062951"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062952"><span class="hs-identifier hs-type">d'</span></a></span><span>
</span><span id="line-334"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062951"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062952"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifyNegate"><span class="hs-identifier hs-type">simplifyNegate</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span>
</span><span id="line-336"></span><span>        </span><span id="local-6989586621679062967"><span class="annot"><span class="annottext">simplifyNumberAndSign :: PExpr -&gt; PExpr -&gt; t PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062967"><span class="hs-identifier hs-var hs-var">simplifyNumberAndSign</span></a></span></span><span> </span><span id="local-6989586621679062968"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062968"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062969"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062969"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679062970"><span class="annot"><span class="annottext">t PExpr
</span><a href="#local-6989586621679062970"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>                                        </span><span class="hs-special">(</span><span id="local-6989586621679062971"><span class="annot"><a href="#local-6989586621679062971"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679062972"><span class="annot"><a href="#local-6989586621679062972"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
forall {m :: * -&gt; *}.
MonadFail m =&gt;
PExpr -&gt; PExpr -&gt; m (PExpr, PExpr)
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">simplfyNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062968"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679062969"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-338"></span><span>                                        </span><span class="annot"><a href="#local-6989586621679062945"><span class="hs-identifier hs-type">simplifySign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062971"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062972"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062970"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>        </span><span id="local-6989586621679062973"><span class="annot"><a href="#local-6989586621679062836"><span class="hs-identifier hs-type">rationalSimplify'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679062973"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062973"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PExpr.html#PExpr"><span class="hs-identifier hs-type">PExpr</span></a></span></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621679062836"><span class="annot"><span class="annottext">rationalSimplify' :: forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var hs-var">rationalSimplify'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Add"><span class="hs-identifier hs-type">Add</span></a></span><span> </span><span id="local-6989586621679063029"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679063029"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>                                        </span><span id="local-6989586621679063030"><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-var">us'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; m PExpr) -&gt; [PExpr] -&gt; m [PExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679063029"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-343"></span><span>                                        </span><span id="local-6989586621679063031"><span class="annot"><a href="#local-6989586621679063031"><span class="hs-identifier hs-var">lcu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="Symplify.html#denominator"><span class="hs-identifier hs-type">denominator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">us'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#lcmList"><span class="hs-identifier hs-type">lcmList</span></a></span><span>
</span><span id="line-344"></span><span>                                        </span><span id="local-6989586621679063032"><span class="annot"><a href="#local-6989586621679063032"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679063033"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063033"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-var">simplifyProduct</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063033"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063031"><span class="hs-identifier hs-var">lcu</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">us'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><a href="Symplify.html#simplifySum"><span class="hs-identifier hs-type">simplifySum</span></a></span><span> </span><span class="hs-comment">-- Multiplico y divido por el lcm de los denominadores</span><span>
</span><span id="line-345"></span><span>                                        </span><span id="local-6989586621679063034"><span class="annot"><a href="#local-6989586621679063034"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063032"><span class="hs-identifier hs-type">u'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063031"><span class="hs-identifier hs-type">lcu</span></a></span><span>
</span><span id="line-346"></span><span>                                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679063034"><span class="hs-identifier hs-type">p'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>                                            </span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063034"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-348"></span><span>                                            </span><span class="annot"><span class="annottext">PExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063034"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Mul"><span class="hs-identifier hs-type">Mul</span></a></span><span> </span><span id="local-6989586621679063035"><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>                                        </span><span id="local-6989586621679063036"><span class="annot"><a href="#local-6989586621679063036"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PExpr -&gt; m PExpr) -&gt; [PExpr] -&gt; m [PExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr]
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">m [PExpr] -&gt; ([PExpr] -&gt; m PExpr) -&gt; m PExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; [PExpr] -&gt; m PExpr
</span><a href="Symplify.html#simplifyProduct"><span class="hs-identifier hs-var">simplifyProduct</span></a></span><span>
</span><span id="line-351"></span><span>                                        </span><span id="local-6989586621679063037"><span class="annot"><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#numerator"><span class="hs-identifier hs-type">numerator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063036"><span class="hs-identifier hs-type">u'</span></a></span><span>
</span><span id="line-352"></span><span>                                        </span><span id="local-6989586621679063038"><span class="annot"><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.Algebraic.html#expand"><span class="hs-identifier hs-type">Algebraic.expand</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Symplify.html#denominator"><span class="hs-identifier hs-type">denominator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063036"><span class="hs-identifier hs-type">u'</span></a></span><span>
</span><span id="line-353"></span><span>                                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679063040"><span class="annot"><a href="#local-6989586621679063040"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[PExpr] -&gt; [PExpr] -&gt; [PExpr]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`union`</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; [PExpr]
</span><a href="Simplification.PolyTools.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-354"></span><span>                                        </span><span id="local-6989586621679063041"><span class="annot"><a href="#local-6989586621679063041"><span class="hs-identifier hs-var">ggcd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#polyGCD"><span class="hs-identifier hs-type">polyGCD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063037"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063038"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063040"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-355"></span><span>                                        </span><span id="local-6989586621679063042"><span class="annot"><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063037"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063041"><span class="hs-identifier hs-type">ggcd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063040"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-356"></span><span>                                        </span><span id="local-6989586621679063043"><span class="annot"><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Simplification.PolyTools.html#quotient"><span class="hs-identifier hs-type">quotient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063038"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063041"><span class="hs-identifier hs-type">ggcd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063040"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-357"></span><span>                                        </span><span class="annot"><a href="#local-6989586621679062967"><span class="hs-identifier hs-type">simplifyNumberAndSign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063042"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063043"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063040"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PExpr.html#Pow"><span class="hs-identifier hs-type">Pow</span></a></span><span> </span><span id="local-6989586621679063044"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063044"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679063045"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063045"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TriBool -&gt; Bool
</span><a href="TriBool.html#true"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="annot"><span class="annottext">(TriBool -&gt; Bool) -&gt; TriBool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; TriBool
forall a. Assumptions a =&gt; a -&gt; TriBool
</span><a href="Classes.Assumptions.html#isInteger"><span class="hs-identifier hs-var">isInteger</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063045"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>                                      </span><span id="local-6989586621679063046"><span class="annot"><a href="#local-6989586621679063046"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall (m :: * -&gt; *). MonadFail m =&gt; PExpr -&gt; m PExpr
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063044"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-361"></span><span>                                      </span><span id="local-6989586621679063047"><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#numerator"><span class="hs-identifier hs-type">numerator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063046"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`simplifyPow`</span></span><span> </span><span class="annot"><span class="hs-identifier">e</span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>                                      </span><span id="local-6989586621679063048"><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Symplify.html#denominator"><span class="hs-identifier hs-type">denominator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063046"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`simplifyPow`</span></span><span> </span><span class="annot"><span class="hs-identifier">e</span></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>                                      </span><span class="annot"><a href="Symplify.html#simplifyDiv"><span class="hs-identifier hs-type">simplifyDiv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">rationalSimplify'</span></a></span><span> </span><span id="local-6989586621679063049"><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PExpr -&gt; m PExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PExpr
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">u</span></a></span></pre></body></html>